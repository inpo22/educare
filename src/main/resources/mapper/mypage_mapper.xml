<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC   "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.edu.care.dao.MypageDAO">

<!-- 학생 개인정보수정 쿼리문 -->
<update id="update" parameterType="map">
	UPDATE user SET
		email=#{email}, 
		phone=#{phone},
		birth=#{birth},
		gender=#{gender},
		pw = CASE WHEN #{pw} IS NULL THEN pw ELSE #{pw} END,
		photo = CASE WHEN #{photo} IS NULL THEN photo ELSE #{photo} END
	WHERE user_code=#{user_code}
		
</update>

	
	<select id="empMypage" resultType="mypage">
		SELECT
			u.user_code
			, u.name AS user_name
			, u.phone
			, u.email
			, u.reg_date
			, u.photo
			, ac.code_name AS class_name
			, d.team_name
		FROM user u JOIN all_code ac ON u.class_code = ac.code JOIN department d ON u.team_code = d.team_code
		WHERE u.user_code = #{param1}
	</select>
	
	<update id="empProfileEdit" parameterType="mypage">
		UPDATE user
			SET email = #{email}, phone = #{phone}
		WHERE user_code = #{user_code}
	</update>
	
	<update id="profileImgSave">
		UPDATE user
			SET photo = #{param2}
		WHERE user_code = #{param1}
	</update>
	
</mapper>